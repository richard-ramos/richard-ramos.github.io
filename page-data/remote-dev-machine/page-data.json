{"componentChunkName":"component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js","path":"/remote-dev-machine/","result":{"data":{"site":{"siteMetadata":{"title":"Hello, I'm RichΛrd","social":[{"name":"twitter","url":"https://twitter.com/richardramos_me"},{"name":"github","url":"https://github.com/richard-ramos"}]}},"blogPost":{"__typename":"MdxBlogPost","id":"e174de5b-e4e8-52d9-a8a6-25211bf48c68","excerpt":"One of the inconveniences of being a remote worker in the Dominican Republic is that there's always a chance of power outage. So far I have…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Setting up a remote development environment\",\n  \"date\": \"2020-04-18T00:00:00.000Z\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"One of the inconveniences of being a remote worker in the Dominican Republic is that there's always a chance of power outage.\"), mdx(\"p\", null, \"So far I have solved this problem by having a power inverter, batteries and a UPS to power most of my devices, but there have been times that these power outages have outlasted my batteries life so I have to rely on my laptop's battery.\"), mdx(\"p\", null, \"While its battery is good, having achieved more than 6hrs of battery life while using the browser + wifi, the moment I have to do something serious I get less than 2 hours of battery life, specially when I use Electron apps like Visual Studio Code and Discord.\"), mdx(\"p\", null, \"There's been also occasions when I'm not in my home and I still want to work, and there is no power outlets available.\"), mdx(\"p\", null, \"What I tipically do in these cases is:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Use my cell phone as a mobile hotspot (I have an unlimited data plan), \"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Connect my phone to a portable charger\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Close unused / non-critical applications (i.e. I'll run Skype and Discord on my phone instead of my laptop), \"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Code on Vi instead of VS Code.\")), mdx(\"p\", {\n    style: {\n      \"textAlign\": \"center\"\n    }\n  }, mdx(\"img\", {\n    src: setup\n  })), mdx(\"p\", null, \"This increases my battery life to an acceptable 3hrs, but lately I've been exploring on having a remote development environment instead of running everything on my local machine, increasing my battery life in the meantime. Let's dive in on my current setup.\"), mdx(\"h2\", null, \"Generating a local SSH key\"), mdx(\"p\", null, \"We'll connect to the remote server via SSH. There are two ways to do it: the insecure way, using a password, or the secure way: an SSH key. I'll use this method.\"), mdx(\"p\", null, \"Start by generating a keypair in your local machine with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ssh-keygen\"), \" (read more about this command \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.ssh.com/ssh/keygen/\"\n  }), \"here\"), \")\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"ssh-keygen\\n\")), mdx(\"p\", null, \"You'll be prompted for the directory where to store the key (press enter to use the default), and an optional passphrase.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"Generating public/private rsa key pair.\\nEnter file in which to save the key (/home/myuser/.ssh/id_rsa): \\nCreated directory '/home/test/.ssh'.\\nEnter passphrase (empty for no passphrase): \\nEnter same passphrase again: \\nYour identification has been saved in /home/test/.ssh/id_rsa.\\nYour public key has been saved in /home/test/.ssh/id_rsa.pub.\\nThe key fingerprint is:\\nSHA256:zl7DAyCXl+que2+9djnhdHdNGxa65idRwb417RyMxlM test@laptop\\nThe key's randomart image is:\\n+---[RSA 2048]----+\\n|            . *E |\\n|             * *.|\\n|            . o.B|\\n|              .*.|\\n|        B. . ooo+|\\n|      .oo.o o o+=|\\n|       oBo.. . +B|\\n|       . .ooo o=B|\\n|        .o++.++o=|\\n+----[SHA256]-----+\\n\\n\")), mdx(\"p\", null, \"This will generate two files: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"~/.ssh/id_rsa\"), \" (your private key, do not share this file), and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"~/.ssh/id_rsa.pub\"), \" (the public key). We'll use the content of this file when creating the remote environment.\"), mdx(\"p\", null, \"It's also a good idea to backup these files\"), mdx(\"h2\", null, \"Creating your remote machine\"), mdx(\"p\", null, \"After looking at different cloud providers, I ended up choosing \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.digitalocean.com/\"\n  }), \"DigitalOcean\"), \". There are other alternatives available like AWS or Azure. Setting up my remote development environment, I found there aren't many differences between providers except for cost. The first step is to go to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.digitalocean.com\"\n  }), \"digitalocean.com\"), \", and after creating an account, we need to create a droplet. I'm using Ubuntu 19.10 x64, with 8GB of ram and 4 CPUs. At the moment of writing, the cost is 40 USD/Month. \"), mdx(\"img\", {\n    src: doConfig2,\n    style: {\n      \"margin\": \"4px\",\n      \"cssFloat\": \"right\"\n    }\n  }), mdx(\"p\", null, \"For increased security, the authentication method used will be \\\"SSH keys\\\". \"), mdx(\"p\", null, \"Add your previously created public SSH key by copying the content of the file \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"~/.ssh/id_rsa.pub\"), \". \"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"# You can copy the content of the file from the terminal\\ncat ~/.ssh/id_rsa.pub\\n\\n# Or copy the content of the file to the clipboard\\nxclip -selection clipboard ~/.ssh/id_rsa.pub`\\n\")), mdx(\"p\", null, \"Set the hostname, and click on \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Create Droplet\"), \", and wait until your droplet has been created.\"), mdx(\"img\", {\n    src: doDroplet\n  }), mdx(\"h2\", null, \"Initial setup of your remote machine\"), mdx(\"p\", null, \"We need to create an user that we will to use to setup our development environment. This user will also have the same authorized key to only allow login into this server with this user from our local machine. This user will also be part of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"sudo\"), \" group.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"adduser myuser\\nusermod -aG sudo myuser\\nmkdir ~myuser/.ssh\\ncat ~/.ssh/authorized_keys >> ~myuser/.ssh/authorized_keys\\nchown -R myuser:myuser ~myuser/.ssh/\\n\")), mdx(\"p\", null, \"We'll set up a basic firewall with only SSH access.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"ufw allow OpenSSH\\nufw enable\\nufw status\\n\")), mdx(\"p\", null, \"After executing the previous command, you will see the following output:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"Status: active\\n\\nTo                         Action      From\\n--                         ------      ----\\nOpenSSH                    ALLOW       Anywhere\\nOpenSSH (v6)               ALLOW       Anywhere (v6)\\n\")), mdx(\"p\", null, \"In your local machine, edit the file \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"~/.ssh/config\"), \" and add the following content (replace \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<ip-address>\"), \" with the IP address of the droplet):\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"Host remote-dev    \\n  HostName <ip-address> \\n  ServerAliveInterval 60\\n  ServerAliveCountMax 10\\n  User myuser    \\n  IdentityFile ~/.ssh/id_rsa\\n\")), mdx(\"p\", null, \"You should be able to connect with your new user by using\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"ssh remote-dev\\n\")), mdx(\"p\", null, \"Notice that we did not have to use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"root@<ip-address>\"), \" thanks to the setup we made in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"~/.ssh/config\"), \".\"), mdx(\"h2\", null, \"Dotfiles, Packages, and Docker\"), mdx(\"p\", null, \"Install common tools and configurations. It's a good moment to use your \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/richard-ramos/dotfiles\"\n  }), \".dotfiles\"), \". There are some packages I usually install in all my machines:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"sudo apt update\\nsudo apt install curl htop tmux build-essential net-tools git gpg\\n\")), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://neovim.io/\"\n  }), \"Neovim\"), \" and \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.docker.com/\"\n  }), \"Docker\"), \" can also be installed in this step\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"# Neovim\\ncurl -LO https://github.com/neovim/neovim/releases/download/stable/nvim.appimage\\nchmod u+x nvim.appimage    \\nsudo mv ./nvim.appimage /usr/bin/nvim \\npip3 install neovim    \\n\\necho \\\"alias vim=nvim\\\" >> ~/.bash_aliases\\necho \\\"alias vi=nvim\\\" >> ~/.bash_aliases\\nsource ~/.bash_aliases\\n\\n\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"# Docker\\nsudo apt-get install -y \\\\\\n    apt-transport-https \\\\\\n    ca-certificates \\\\\\n    gnupg-agent \\\\\\n    software-properties-common\\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\\nsudo add-apt-repository \\\\\\n   \\\"deb [arch=amd64] https://download.docker.com/linux/ubuntu \\\\\\n   disco \\\\\\n   stable\\\"\\nsudo apt update\\nsudo apt install -y docker-ce docker-ce-cli containerd.io\\nsudo docker run hello-world\\n\")), mdx(\"h2\", null, \"Install your development environment\"), mdx(\"p\", null, \"This will depend on the tools/languages you use for development. i.e. the following commands would install a Node.js environment on your remote machine with the latest LTS version, using \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/nvm-sh/nvm\"\n  }), mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"nvm\")), \" (Node Version Manager), and the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.yarnpkg.com\"\n  }), \"`yarn\"), \" package manager.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash\\nsource .bashrc\\nnvm install --lts\\n\\ncurl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -\\necho \\\"deb https://dl.yarnpkg.com/debian/ stable main\\\" | sudo tee /etc/apt/sources.list.d/yarn.list\\nsudo apt update && sudo apt install yarn\\n\")), mdx(\"h2\", null, \"VS Code on your browser\"), mdx(\"p\", null, \"Neovim is my default editor of choice, but for some projects I prefer to use \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://code.visualstudio.com/\"\n  }), \"Visual Studio Code\"), \". So far, the only problem I have found with it is how many resources it uses, thus reducing my machine's battery life. I'm experimenting with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"code-server\"), \", which let's you install VS Code in the server and run an instance in the browser.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"wget https://github.com/cdr/code-server/releases/download/3.1.1/code-server-3.1.1-linux-x86_64.tar.gz\\ntar xvfz ./code-server-3.1.1-linux-x86_64.tar.gz\\ncd code-server-3.1.1-linux-x86_64/\\nchmod u+x code-server \\n\")), mdx(\"p\", null, \"We also  need to open the port 8080 in our firewall:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"sudo ufw allow 8080/tcp\\n\")), mdx(\"p\", null, \"To start the server, \"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"./code-server --port 8080 --host 0.0.0.0\\n\")), mdx(\"p\", null, \"Executing this command will print information about the service, including the password for accessing the editor:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"info  code-server 3.1.1 28e91ba70cd70fa9adf3f2e3e3b87631b5667ecf\\ninfo  HTTP server listening on http://0.0.0.0:8080\\ninfo    - Password is ABCDEF0123456ABCDEF\\ninfo      - To use your own password set the PASSWORD environment variable\\ninfo      - To disable use `--auth none`\\ninfo    - Not serving HTTPS\\ninfo  Automatic updates are enabled\\ninfo  SSH server listening on localhost:42663\\ninfo    - To disable use `--disable-ssh`\\n\")), mdx(\"p\", {\n    style: {\n      \"textAlign\": \"center\"\n    }\n  }, mdx(\"img\", {\n    src: login\n  })), mdx(\"p\", null, \"In a browser, open the URL \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://your-server-ip:8080\"\n  }), \"http://your-server-ip:8080\"), \" and enter the password.\"), mdx(\"p\", {\n    style: {\n      \"textAlign\": \"center\"\n    }\n  }, mdx(\"img\", {\n    src: vscode\n  })), mdx(\"p\", null, \"The editor will display the following message: \"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"code-server is being accessed over an insecure domain. Web views, the clipboard, and other functionality will not work as expected. \")), mdx(\"p\", null, \"This can be fixed by using a reverse proxy, and assigning a domain to this server and a certificate (You can obtain one from \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://letsencrypt.org/\"\n  }), \"https://letsencrypt.org/\"), \"). I still haven't configured this, so I'm not sure of its implications.\"), mdx(\"h2\", null, \"Remote development with VS Code on your local machine\"), mdx(\"p\", null, \"You can develop with VS Code on your local machine connected to your remote environment, by installing the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Remote Development\"), \" extension\"), mdx(\"img\", {\n    src: remoteDevelopment\n  }), mdx(\"p\", null, \"Once it's installed, in the menu on the left you'll see a new option that once selected will let you connect to the remote server you defined in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"~/.ssh/config\"), \" and also edit this file.\"), mdx(\"img\", {\n    src: remoteDevelopmentIcon\n  }), mdx(\"p\", null, \"Right-click \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"remote-dev\"), \" in the list and select \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Connect to host in New Window\"), \". \"), mdx(\"p\", null, \"In this new VS Code window you'll be able to open folders and files on your remote server to edit, as well as executing commands on the VS Code terminal that will be connected to this server too. \"), mdx(\"p\", null, \"On this window you'll also be able to forward ports on your remote environment to your local machine in case you want to access a service on that machine.\"), mdx(\"h2\", null, \"Reducing costs.\"), mdx(\"p\", null, \"Having a remote dev environment it's not cheap (depending on your income). The droplet selected has a monthly cost of 40 USD, for a server running 24/7, compared to only using your local machine. I don't use that remote environment that much, so I want to be billed only for the time I'm using my machine.\"), mdx(\"p\", null, \"Powering off a droplet is not enough, since you're still being billed for it (there are resources associated to it like the IP Address and Storage so it makes sense to be still billed for this machine). DigitalOcean provides a way to reduce that cost by using the snapshot functionality. \"), mdx(\"p\", null, \"You must power off your machine, and then, in the your droplet menu, select \\\"Snapshots\\\", and click on \\\"Take live snapshot\\\".\"), mdx(\"p\", null, \"After your snapshot is created, in the droplet menu, select \\\"Destroy\\\", and then click on \\\"Destroy this Droplet\\\".\"), mdx(\"p\", null, \"You'll be billed from now on only for the snapshot storage ($0.05/GB/mo). If you followed this guide, that's 8 USD per month assuming you don't use that machine in the last month. You save 32 USD!\"), mdx(\"p\", null, \"To restore the snapshot, Create a new droplet, and select \\\"Snapshots\\\" and the snapshot you created. Choose the same plan configuration (8GB/4CPU), hostname, and then create the droplet.\"), mdx(\"p\", null, \"You'll end up with a machine containing the same configuration you created, but with a new IP address. Remember to edit \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"~/.ssh/config\"), \" to replace the old droplet IP with this new address.\"), mdx(\"h2\", null, \"Final thoughts\"), mdx(\"p\", null, \"Setting up this remote environment is a nice exercise and requires a minimal time investment. I believe it was worth it because it allowed me to have an alternative fore when the resources on my local machine are limited. (I could even use an iPad as a local machine if I wanted to with this configuration). \"), mdx(\"p\", null, \"My workflow does not change much: the moment I have to go off-the-grid, I set my cellphone as hotspot, connect my laptop to it, push to Github my work, close everything, open a terminal and ssh into my remote environment, and pull my latest changes and continue working \\\"normally\\\". Switching environments takes less than 3 minutes so there's not much time wasted.\"), mdx(\"p\", null, \"I'm still not sure yet about using this setup to work 100% on it, mainly because I don't think it's a definitive solution for some use cases, like mobile development, but it could work for the development of web apps and decentralized applications.\"), mdx(\"p\", null, \"In a second part of this post I'll detail this configuration and comment on my results. I expect \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"code-server\"), \" to be beneficial for my use case, since most of the heavy lifting will be executed in the server instead of my machine, meaning fewer resources used when I'm being mobile. There's also some lag when files are saved, but nothing that would affect my productivity (results might vary).\"), mdx(\"p\", null, \"There are some things I want to explore to improve this setup: using \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.terraform.io/\"\n  }), \"Terraform\"), \" and \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://nixos.org/nix/\"\n  }), \"Nix\"), \" for the automatic provisioning and setup, but for now, I'm happy with this configuration\"));\n}\n;\nMDXContent.isMDXComponent = true;","slug":"/remote-dev-machine/","title":"Setting up a remote development environment","tags":[],"keywords":[],"date":"April 18, 2020"},"previous":{"__typename":"MdxBlogPost","id":"bbc52208-7123-5822-b72b-143ef679c1f5","excerpt":"The Little Man Computer (LMC), created by Dr. Stuart Madnick in 1965, simulates a simple von Neumann architecture computer. It is used to…","slug":"/lmc/","title":"Little Man Computer","date":"April 10, 2020"},"next":{"__typename":"MdxBlogPost","id":"aff624db-3b5c-558f-8e3c-705273e2893a","excerpt":"The  ESP8266  is an awesome Wi-Fi microcontroller, with full TCP/IP capability. It's very popular among hackers and hundreds of tutorials…","slug":"/esp-01/","title":"Wiring up a Wifi Module ESP-01","date":"April 26, 2020"}},"pageContext":{"id":"e174de5b-e4e8-52d9-a8a6-25211bf48c68","previousId":"bbc52208-7123-5822-b72b-143ef679c1f5","nextId":"aff624db-3b5c-558f-8e3c-705273e2893a"}}}